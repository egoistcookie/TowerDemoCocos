# 古树防线

## 游戏简介

在暗夜精灵的古老森林中，生命之树正遭受兽人大军的威胁。作为精灵指挥官，你需要建造防御塔、兵营等建筑，训练弓箭手、女猎手等兵种，构筑坚固防线。通过合理的建筑布局、单位生产和资源管理，抵御一波波敌人的进攻，守护生命之树不被摧毁。

## 核心玩法

- **塔防策略**：在指定网格区域建造防御建筑，合理布局阻挡敌人
- **单位生产**：通过战争古树、猎手大厅等建筑训练精灵战士
- **资源管理**：合理使用金币建造建筑，管理人口上限
- **多波次防御**：抵御20波敌人进攻，每5波出现一次挑战提示
- **单位控制**：可多选单位进行移动和战术部署

## 人口系统

人口系统是游戏中的核心资源管理机制，限制玩家可同时拥有的单位数量，增加策略深度。

### 人口机制

- **初始人口上限**：游戏开始时，人口上限为10
- **当前人口**：显示当前已占用的入口数量，初始为0
- **人口占用**：每个生产出的战斗单位（弓箭手、女猎手、精灵剑士、牧师）占用1个人口
- **人口限制**：当人口达到上限时，无法继续生产新的单位

### 人口上限提升

- **生命之树升级**：每次升级生命之树，人口上限增加10
  - 1级生命之树：人口上限10
  - 2级生命之树：人口上限20
  - 3级生命之树：人口上限30
  - 以此类推

### 人口占用规则

**占用人口的单位**：
- **弓箭手**：占用1个人口（由战争古树生产）
- **女猎手**：占用1个人口（由猎手大厅生产）
- **精灵剑士**：占用1个人口（由剑士小屋生产）
- **牧师**：占用1个人口（由教堂生产）

**不占用人口的建筑**：
- **战争古树**：不占用人口，但生产的弓箭手占用人口
- **猎手大厅**：不占用人口，但生产的女猎手占用人口
- **剑士小屋**：不占用人口，但生产的精灵剑士占用人口
- **教堂**：不占用人口，但生产的牧师占用人口
- **月亮井**：不占用人口
- **石墙**：不占用人口
- **生命之树**：不占用人口

### 人口管理

- **自动释放**：单位死亡时，自动释放占用的入口
- **生产检查**：建筑在生产单位前会检查是否有人口空间，人口已满时停止生产
- **UI显示**：游戏界面顶部显示当前人口和人口上限（格式：人口: X/Y）
- **实时更新**：人口变化时，UI会实时更新显示

### 策略意义

人口系统要求玩家在有限的入口下做出战略选择：
- **单位搭配**：需要平衡不同单位类型的数量
- **升级时机**：合理规划生命之树的升级时机，以提升人口上限
- **资源分配**：在人口限制下，合理分配资源建造建筑和生产单位
- **战术调整**：根据战况调整单位配置，及时补充损失的单位

## 金币系统

金币系统是游戏中的核心经济资源，用于建造建筑、升级单位和建筑，是玩家发展防御力量的基础。

### 金币机制

- **初始金币**：游戏开始时，玩家拥有10金币
- **金币显示**：游戏界面顶部显示当前金币数量（格式：金币: X）
- **实时更新**：金币变化时，UI会实时更新显示

### 金币获取

**消灭敌人奖励**：
- **兽人战士**：消灭后获得2金币
- **兽人督军**：消灭后获得5金币
- **巨魔投矛手**：消灭后获得3金币
- 敌人死亡时自动奖励金币，无需手动操作

**建筑回收**：
- **拆除建筑**：拆除建筑时，回收建造成本的80%
  - 战争古树：建造成本10金币，回收8金币
  - 猎手大厅：建造成本10金币，回收8金币
  - 剑士小屋：建造成本10金币，回收8金币
  - 教堂：建造成本10金币，回收8金币
  - 石墙：建造成本5金币，回收4金币
  - 单位（弓箭手、女猎手等）：回收建造成本的80%

### 金币消耗

**建筑建造**：
- **战争古树**：10金币
- **猎手大厅**：10金币
- **剑士小屋**：10金币
- **教堂**：10金币
- **石墙**：5金币

**单位升级**：
- **建筑升级**：升级成本为建造成本的50%
  - 战争古树升级：5金币
  - 猎手大厅升级：5金币
  - 剑士小屋升级：5金币
  - 教堂升级：5金币
- **单位升级**：升级成本为建造成本的2倍
  - 弓箭手升级：建造成本×2
  - 女猎手升级：建造成本×2
  - 精灵剑士升级：建造成本×2
  - 牧师升级：建造成本×2

**生命之树升级**：
- **2级**：10金币
- **3级**：15金币（10 + 5）
- **4级**：20金币（10 + 5×2）
- **5级**：25金币（10 + 5×3）
- 升级费用公式：10 + (目标等级 - 2) × 5

### 金币检查机制

- **建造检查**：建造建筑前会检查金币是否足够，不足时显示"金币不足"提示
- **升级检查**：升级单位或建筑前会检查金币是否足够，不足时无法升级
- **自动扣除**：金币足够时，建造或升级操作会自动扣除相应金币

### 策略意义

金币系统要求玩家合理规划资源使用：
- **优先级管理**：根据战况决定优先建造哪些建筑
- **经济平衡**：平衡建造、升级和回收的时机，最大化资源利用
- **战斗收益**：通过消灭敌人获取金币，鼓励主动防御
- **资源回收**：拆除不需要的建筑可回收部分金币，提供调整策略的机会
- **长期规划**：合理规划生命之树升级时机，平衡人口上限提升和金币消耗

## 计时系统

计时系统是游戏的核心机制之一，管理游戏总时长、波次节奏、倒计时提示和单位生产/升级时间。

### 游戏总时长

- **初始时间**：游戏开始时，总时长为10分钟（600秒）
- **倒计时显示**：游戏界面顶部显示剩余时间（格式：时间: MM:SS）
- **实时更新**：每秒更新一次显示，精确到秒
- **胜利条件**：当倒计时归零时，如果生命之树未被摧毁，玩家获得胜利
- **游戏状态**：只有在游戏进行中（Playing状态）时，倒计时才会减少

### 波次系统

**波次机制**：
- **波次配置**：游戏共有20波敌人，每波都有独特的配置和难度
- **波次延迟**：每波开始前有延迟时间（preWaveDelay），给玩家准备时间
- **波次提示**：每波开始时，屏幕会显示波次名称和描述
- **波次间隔**：当前波次的所有敌人被消灭后，开始下一波的延迟计时

**波次倒计时弹窗**：
- **触发时机**：每完成5波（第5、10、15波完成后）会触发倒计时弹窗
- **显示位置**：弹窗显示在屏幕右上角
- **显示内容**：
  - 前5秒：显示"下一波敌人"文本
  - 之后：显示60秒倒计时，带圆弧边框进度显示
- **交互方式**：
  - 可手动点击关闭，立即开始下一波
  - 倒计时结束后自动关闭，开始下一波
  - 60秒后自动继续，即使未关闭弹窗

### 单位生产计时

**建筑生产计时**：
- **战争古树**：生产弓箭手需要一定时间，显示生产进度条
- **猎手大厅**：生产女猎手需要一定时间，显示生产进度条
- **剑士小屋**：生产精灵剑士需要一定时间，显示生产进度条
- **教堂**：生产牧师需要一定时间，显示生产进度条
- **进度显示**：生产过程中，建筑上方显示进度条，每0.5秒更新一次

**生产限制**：
- **人口检查**：生产前检查人口上限，人口已满时停止生产
- **数量限制**：每个建筑有最大生产数量限制
- **自动补充**：单位死亡后，建筑会自动补充生产

### 升级计时

**生命之树升级**：
- **升级时长**：升级需要一定时间完成，显示升级进度条
- **进度显示**：升级过程中，生命之树上方显示进度条
- **升级效果**：升级完成后，人口上限增加10

**建筑和单位升级**：
- **即时升级**：建筑和单位的升级是即时的，无需等待时间
- **升级条件**：需要足够的金币才能升级

### 攻击计时

**单位攻击间隔**：
- **攻击计时器**：每个单位都有独立的攻击计时器
- **攻击间隔**：单位根据攻击间隔（attackInterval）进行攻击
- **计时器重置**：每次攻击后，攻击计时器重置为0

**技能冷却**：
- **战争咆哮**：兽人督军的战争咆哮技能有冷却时间
- **冷却计时**：技能使用后开始冷却计时，冷却完成后可再次使用

### 动画计时

**动画播放**：
- **动画计时器**：每个单位都有动画计时器，控制动画帧切换
- **帧率控制**：根据动画时长和帧数，计算每帧的显示时间
- **动画同步**：攻击动画、移动动画、死亡动画都有独立的计时控制

### 计时系统特点

- **精确计时**：所有计时都基于deltaTime，确保在不同帧率下时间一致
- **状态检查**：计时系统会检查游戏状态，只在游戏进行中时运行
- **UI反馈**：重要的计时都有UI显示，如倒计时、进度条等
- **自动管理**：计时系统自动管理，无需玩家手动操作

### 策略意义

计时系统影响玩家的战略决策：
- **时间管理**：10分钟的时间限制要求玩家高效行动
- **波次准备**：利用波次间隔和倒计时弹窗时间进行防御准备
- **生产规划**：合理安排单位生产时间，确保关键时刻有足够的防御力量
- **升级时机**：在安全的时间窗口进行生命之树升级，避免在敌人进攻时升级
- **节奏控制**：根据倒计时和波次节奏，调整防御策略和资源分配

## 技术信息

- **开发引擎**：Cocos Creator 3.8.7
- **开发语言**：TypeScript
- **目标平台**：微信小程序
- **游戏类型**：塔防策略

## 项目结构

```
assets/
├── scripts/          # TypeScript脚本文件
│   ├── GameManager.ts      # 游戏主控制器
│   ├── Crystal.ts          # 生命之树（水晶）逻辑
│   ├── WarAncientTree.ts   # 战争古树
│   ├── HunterHall.ts       # 猎手大厅
│   ├── MoonWell.ts         # 月亮井
│   ├── Arrower.ts          # 弓箭手
│   ├── Hunter.ts           # 女猎手
│   ├── Role.ts             # 我方单位基类
│   ├── Build.ts            # 建筑基类
│   ├── Enemy.ts            # 敌人基类
│   └── ...                 # 其他脚本
├── scenes/           # 游戏场景
└── prefabs/          # 预制体资源
```

## 主要单位

### 友方单位
- **弓箭手**：远程攻击单位，射速较快
- **女猎手**：投掷回旋镖，可弹射多个敌人
- **精灵剑士**：近战单位，高血量
- **牧师**：治疗友方单位
- **小精灵**：可依附建筑进行治疗

### 建筑单位
- **战争古树**：生产弓箭手，拥有远程攻击能力
- **猎手大厅**：生产女猎手
- **剑士小屋**：生产精灵剑士
- **教堂**：生产牧师
- **月亮井**：恢复周围单位生命值，增加人口上限
- **石墙**：阻挡敌人前进的障碍物

### 敌方单位
- **兽人战士**：近战敌人
- **兽人督军**：强化版兽人，拥有战争咆哮技能
- **巨魔投矛手**：远程攻击敌人

## 游戏界面与场景

### 主界面（首页）

**场景风格**：暗夜精灵森林主题，采用竖版俯视视角，Q版像素风格。整体背景为暗夜精灵森林风格，四周是茂密的森林，中间有一块空地，放置着一颗尚在幼年期的生命之树。背景采用统一的暗夜精灵森林风格图片，营造神秘而宁静的氛围。

**界面布局**：
- **底部三页签**：位于屏幕最底部，高度200像素，包含三个页签按钮
  - **游戏页签**：点击进入游戏主体界面
  - **天赋页签**：点击进入天赋强化界面
  - **设置页签**：点击进入游戏设置界面
- **三页共用背景**：三个页面共用同一张暗夜精灵森林背景图，确保视觉统一
- **半透明遮罩**：页面切换时使用半透明黑色遮罩（透明度150），保持背景可见的同时突出内容

### 游戏游玩界面

**场景风格**：延续主界面的暗夜精灵森林风格，采用竖版俯视视角。游戏场景为一片开阔的森林空地，中央位置是生命之树（水晶），四周是茂密的森林边界。场景采用Q版像素风格，色彩以深绿色、紫色、金色为主，体现暗夜精灵的神秘与优雅。
这是一张竖构图的2D游戏场景背景图片，采用了柔和的卡通手绘风格。画面的主体是一条宽阔的沙土色道路，从底部一直延伸至顶部。道路两侧被茂密的绿色森林所包围，树木呈现出圆润、层叠的形态。

在画面的上方，横亘着一排整齐的方形石块障碍物，石块表面斑驳并覆盖着青苔。画面的底部正中央矗立着一个造型独特的树形建筑，它由盘根错节的枯木构成，树干中心镶嵌着一块带有神庙图案的方形标志，周围散落着零星的碎石和落叶。整体画面给人一种策略塔防类游戏的视觉感受。

**主要场景元素**：
- **生命之树（水晶）**：位于场景中央，是玩家需要守护的核心目标，呈现为幼年期的生命之树形态，散发着柔和的蓝色光芒
- **建筑网格区域**：位于画面下方，4x4的透明网格面板，每个格子100x100像素，格子间隔10像素，用于建造防御建筑
- **石墙网格区域**：位于画面中下方（y坐标500-1000），15x10的网格，每个格子50x50像素，用于建造石墙障碍物
- **敌人刷新点**：位于屏幕正上方，敌人从上方不断刷新并向生命之树进攻
- **单位战斗区域**：整个场景都是战斗区域，精灵战士在此与敌人战斗

**UI元素布局**：
- **顶部信息栏**：显示生命之树血量、金币数量、人口数量、游戏倒计时
- **建造按钮**：位于屏幕右下角，点击进入建造模式
- **建筑物选择面板**：点击建造按钮后，在屏幕下方弹出，占屏幕约六分之一高度，显示可建造的建筑图标
- **单位信息面板**：选中单位时，在屏幕下方显示单位详细信息，包括属性、操作按钮等
- **倒计时弹窗**：每5波敌人出现时，在屏幕右上角显示倒计时提示，可手动关闭

### 天赋界面

**场景风格**：与主界面共用同一张暗夜精灵森林背景图，保持视觉一致性。界面采用卡片式布局，展示各个单位的强化选项。

**界面元素**：
- **单位卡片**：以九宫格形式展示，每个卡片显示单位的icon图片
- **详细信息面板**：点击卡片后显示单位的详细属性展示页面
- **卡片边框**：支持添加边框贴图，增强视觉效果
- **蓝色主题**：天赋面板采用蓝色调，与游戏主体页面区分

### 设置界面

**场景风格**：同样使用暗夜精灵森林背景图，保持整体风格统一。

**界面元素**：
- **音效开关**：可打开或关闭游戏音效
- **其他设置选项**：预留扩展空间，可添加更多游戏设置

## 游戏特色

- 暗夜精灵主题，Q版像素风格
- 丰富的单位类型和建筑系统
- 策略性的建筑布局和单位部署
- 多波次敌人挑战，难度递增
- 天赋系统，可强化单位属性
- 统一的视觉风格，沉浸式游戏体验

## 开发状态

项目正在持续开发中，更多功能和优化正在添加。

