


# 23-20251222
- 修复问题：当单位介绍框出现时，退出建造模式，如果正打开建筑物面板，也要自动关闭建筑物面板
- 优化牧师：会治疗自己，会治疗其他牧师
- 修复缺陷：建筑物被摧毁或者回收之后，其位置上不能放置新的建筑物
- 


# 22-20251217
- 新增建筑物单位：教堂，参考弓箭手小屋的脚本，继承自Build.ts，功能与弓箭手小屋几乎一样，除了教堂训练的兵种为牧师，并且教堂没有攻击功能;
- 新增单位：牧师，参考弓箭手脚本，继承自Role.ts，但是移动方式改为向附近血量未满的友方单位移动，攻击方式改为治愈附近血量未满的友方单位，友方单位包括弓箭手、剑士、女猎手；
- 抽象Hunter.ts和ElfSwordsman.ts ，继承Role.ts，重写攻击等必要方法即可

- TODO bug1：关闭介绍框后，女猎手的攻击动画不再正常播放

# 21-20251212-1214
- 石墙网格：新增一个长15格、高10格的网格，每个格子占50x50像素，格子之间没有间隔，参考BuildingGridPanel.ts的做法，网格整体的y坐标范围为500-1000，x坐标范围为0-750，修改石墙的放置逻辑，石墙只能放置在石墙网格之中，不能超出网格范围，也不能与其他石墙重叠，石墙网格单独创建一个预制体；
- 敌人探路逻辑：重写敌人的探路逻辑，当石墙网格的位置在敌人下方时，以石墙网格为最高优先级移动；石墙网格中放置了石墙的格子不能走，敌人需要在石墙网格中找到一条通往最底层即网格0层的路径，到达0层后，再往水晶移动；如果石墙网格中没有路可走，则攻击距离敌人最近的石墙，摧毁石墙之后再寻找下一个目标点；还是需要把每一个目标点标注出来；
- 抽象出敌人的父类：改造@Enemy.ts ，将移动和攻击逻辑抽象出来生成一个父类Enemy.ts，代表敌人，然后新建一个子类Orc.ts，是敌人的一种，为Enemy.ts的子类，预制体也需要创建为orc，orc的逻辑与现在的@Enemy.ts 保持完全一致，只是增加了代码的扩展性
- 修改TrollSpearman.ts，使其也继承@Enemy.ts ，但是除了属性值不同，他的attack方法也需要重写，因为他是远程攻击方式，会createSpear攻击，其他逻辑使用公共的敌人逻辑
- 优化单位提示框：修改单位首次出现时的提示框，如果出现提示框，就不能点击建造按钮
- 出现单位提示框的时候，应该先关闭掉已经打开的建造面板、并退出建造模式
- 抽象出我方单位的父类：改造@Arrower.ts ，将移动和攻击逻辑抽象出来生成一个父类Role.ts，代表我方单位，然后新建一个子类Arrower.ts，是我方单位的一种，为Role.ts的子类，子类中只有属性是自定义的，父类的属性都是protected级别，子类可以重写，增加代码的扩展性

- 优化敌人@Enemy.ts ，为敌人增加碰撞体积，参考@Arrower.ts 的碰撞体积做法，敌人之间互相会有碰撞，不能完全重叠在一起，orc的体积是10，投矛手和兽人战士的体积是20

# 20-20251208
- 限制建筑位置（参考《这里没有兽人》）：建筑物改为只能建造在游戏画面下方的一个4x4的透明面板之中，面板中每隔格子的大小为100x100，格子之间的间隔为10，拖拽建筑物的时候会高亮显示透明面板，建筑物可以在格子之间任意拖动，透明面板最好是单独创建一个预制体，以后可以仍然添加边框贴图与格子大小等属性
- 新增建筑物单位：石墙，参考Tree.ts，复制出石墙的脚本，石墙只是障碍物，阻挡敌人进攻的路线；同时优化敌人的索敌方法，敌人首先不能走出游戏边界，然后默认朝水晶移动，增加一个规则：如果无法绕开石墙，则攻击距离敌人最近的石墙，直到有路可通往水晶；
- 新增建筑物单位：剑士小屋，参考猎手大厅的脚本，复制出来剑士小屋的脚本，内容几乎完全一样，除了剑士小屋训练的兵种为精灵剑士;
- 新增单位：精灵剑士，从弓箭手的脚本里复制出来，但是攻击方式为近战，不会投掷武器，其余内容与弓箭手完全一样；


# 19-20251206 
- 强化兽人督军：兽人督军增加被动技能：战争咆哮，可以添加动画效果和音效，每隔30秒释放一次，释放后此时周围200码范围内的敌人单位都会增加移动速度、攻击速度和攻击力，提升幅度为25%，持续时间为10秒
- 场上首次出现某一种建筑物或者单位时，游戏暂停，出现一个占据屏幕下方三分之一大小的介绍框，介绍框左侧为单位的图片展示，右侧为单位的信息介绍，为每种单位的脚本都增加信息介绍属性，可在cocos添加，该提示框被点击后消失，消失后游戏继续
- 增加敌方单位：巨魔投矛手，脚本从OrcWarrior.ts复制过来，只是修改了贴图和攻击贴图和音效，血量略低于兽人战士，但是攻击距离为远程，等同于弓箭手的攻击距离，同时修改弓箭手、女猎手、战争古树的索敌机制，增加对巨魔投矛手的处理
- 在游戏下方增加选区，第一个选区为游戏主体，点击进去之后打开现在的游戏画面，并且有一个开始游戏的按钮可以控制；第二个选区为天赋，可以在天赋页签强化现在的友方单位；第三个选区为设置，可以在设置页签打开或关闭音效等；
- 现在游戏是直接开始的，我希望改成在游戏主体页签点击了开始游戏之后才开始游戏，现在游戏三个页签的位置也不对，没有放在画面最底部
- 强化天赋界面：为每一种友方单位设置卡片，卡片显示单位的 icon 图片，点开卡片可以进入单位的详细属性展示页面，卡片框和详细信息展示框都支持添加边框贴图

# 18-20251204
- 弓箭手女猎手：弓箭手增加被攻击动画和倒地动画
- 修改敌人的刷新方式，改为全部从屏幕正上方出现
- 强化兽人督军：死亡后最后一张倒地画面作为尸体暂留在战场之上，暂留一分钟，如果尸体的位置在女猎手和弓箭手的攻击轨迹之上，则他们的攻击会被尸体挡住
- 现在兽人督军的尸体已经能够挡住回旋镖，请对Arrow.ts也做相应改造，让尸体能挡住箭矢，另外新增效果：当回旋镖或弓箭命中督军尸体的时候，将回旋镖和箭矢插在尸体身上

# 17-20251203
- 更新刷新敌人的机制，首先把3分钟的游戏结束时间改为10分钟，然后把敌人刷新次数增加到十波，第十波后，屏幕右上角出现一个1分钟的倒计时弹窗，倒计时结束后，开始第10-第20波刷怪，这个倒计时弹窗也可以手动点掉，代表玩家已经准备好迎战第10-第20波的敌人，此时立即开始下一轮的刷怪
- 半透明圆形弹窗的大小缩小到原来的一半，位置往上移，靠近屏幕右上角，与最右保持50像素，与最上保持200像素，同时不要通过一个×号来关闭，而是通过直接点击弹窗来关闭并触发下一波刷怪，同时优化弹窗消失的效果，仿造泡沫破碎的效果
- 弹窗的风格已经很好了，现在改为每隔5波出现一次弹窗，第一关一共20波敌人
- 新增敌方单位：兽人督军，兽人战士的升级版，ts可以从OrcWarrior.ts复制过来，只是修改了贴图和攻击贴图和音效，修改弓箭手、女猎手的索敌机制，增加对兽人督军的处理
- 强化兽人督军，只有在1秒内受到大于生命值五分之一伤害时才会产生僵直、即播放被攻击动画
- TODO：bug：战争古树不会攻击兽人战士和兽人督军

# 16-20251202
- 增强点击功能，长按住画面之后可以将游戏画面往上下移动，需要修改 SelectionManager.ts 的onTouchStart、onTouchMove、onTouchEnd方法 ，参考 GameController.ts 里的做法，区别长按和拖拽框选几种触摸操作
- 敌人不会攻击猎手大厅，月亮井不会治愈女猎手
- 去掉长按拖拽功能，暂时只考虑一个手机屏幕内能实现的玩法
- 小精灵不能依附在猎手大厅
- 新增单位：新增一种敌人单位，兽人战士，脚本完全从Enemy.ts复制过来，只是修改了贴图和攻击贴图和音效
- 兽人战士：修改兽人战士的攻击动画播放方式，改为与行走动画一样的播放方式，不要再使用ani效果
- bug：弓箭手和女猎手不会攻击兽人战士，请优化我方单位的索敌机制，增加一个单位类型，兽人战士和enemy归为敌方单位，以后我新增其他敌方单位也可以不用修改代码就能让我方单位自动索敌敌方单位
- 修改刷新敌人的机制，使用外部配置文件如JSON、XML来管理所有波次和敌人组合

# 15-20251201
- 优化敌人：敌人没有把猎手大厅当做是建筑物，没有去攻击猎手大厅，战争古树和猎手大厅和月亮井，应该同属于建筑物类型，应该将它们设置为同一种类型，敌人按照单位类型来进行索敌，也以便于以后拓展建筑物类型，就不用每次都修改敌人的ts代码了
- 优化女猎手：更改女猎手的攻击方式，在女猎手投掷完回旋镖之后，回旋镖回再飞回到女猎手手中
- 优化女猎手：进一步增强女猎手的攻击方式，回旋镖可以在相邻的敌人之间弹射，每次弹射的伤害值为当前伤害值的0.5倍，最多弹射3次，敌人之间的距离需要小于100像素（可配置），弹射3次之后、或者最后一名敌人附近100像素内没有其他敌人时，回旋镖从最后一名敌人的位置飞回到女猎手手中
- 敌人的checkForTargetsOnPath算法有可以优化的空间，高效做法应该是获取到所有检测范围内的对象，然后获取到这些对象的单位类型，然后设定距离最近的优先级最高的单位为目标
- 主屏幕：现在的画面有点狭小，怎么把游戏画面变成一个可以向下拉伸的竖版画面，高度扩充为现在的两倍，如何设置cocos creator的场景大小，
- 游戏画面只是变得更加细长了，我希望游戏画面可以往下拉伸，随着鼠标移动而展开下面的画面
- 游戏画面：增强点击功能，长按住画面之后可以将游戏画面往上下移动

# 14-20251130
- 优化敌人：参考弓箭手，支持上传行走、攻击、被攻击、死亡、待机贴图
- 优化敌人：移动时没有朝着对应方向翻转，参考弓箭手；攻击时没有播放攻击动画，被攻击时没有播放被攻击动画，死亡时没有播放死亡动画
- 优化箭矢：箭矢射出的时候支持添加音效，敌人被箭矢击中的时候支持添加音效
- 小精灵贴图：先在pixis haus网站上找到想要的像素风格角色，再用豆包hpp工具反推提示词，再通过混元3.0生图模型生成小精灵名片图
- 小精灵优化：我在cocos里新建了一个SpriteFlash粒子特效的预制体，现在需要添加到小精灵身上，为小精灵设置一个可配置的粒子特效功能
- 优化敌人：优化敌人索敌算法，如果周围50像素内有我方单位如水晶建筑物弓箭手，敌人就会朝我方单位移动，优先级为水晶>弓箭手>建筑物>小精灵，如果50码范围内没有任何我方单位，则朝水晶移动
- 新增单位：增加一个普通树木单位，Tree，可以通过建造面板建造，类似战争古树，只是没有攻击和撤下小精灵选项，可以回收，建造成本1金币，血量20；调整敌人的索敌优先级，水晶>树木>弓箭手>建筑物>小精灵，敌人会被Tree挡住
- 新增建筑物：猎手大厅，其功能完全参考战争古树，只是没有攻击功能，并且训练的兵种为女猎手，女猎手的功能逻辑完全参考弓箭手；

# 13 
- 优化小精灵：小精灵依附在建筑物上时不会被攻击，建筑物被拆除时小精灵出现在建筑物下方，水晶点击训练小精灵后会取消被选中的状态
- 增加提示框：现在点击build按钮的时候，如果金币不足，连建造面板都不会打开，我希望即使金币不足也可以打开建造面板，只是在选中某一个建筑物图标的时候，增加一个弹窗显示不能建造的原因，比如“金币不足”，该弹窗希望做成公共弹窗，以后可以增加其他游戏提示信息，也支持增加弹窗背景贴图，后续可以添加背景贴图


# 12
- 水晶：增加训练小精灵功能，信息面板中增加训练小精灵按钮，训练过程类似于战争古树训练弓箭手，小精灵占用一个人口，小精灵可以依附在建筑物上，为建筑物治疗回血，建筑物可以选择卸下小精灵，小精灵就会回到建筑物前方，敌人会攻击小精灵，小精灵没有攻击能力


# 11
- 界面：当单位被选中的时候，下方显示出该单位的半透明介绍面板，占屏幕六分之一的高度，介绍面板左侧为该单位的展示图，右侧为该单位的名称、等级、生命值、攻击力、占用人口数等属性，选中单位之后，类似月亮井被选中的效果，需要显示出该单位的占地范围和攻击范围
- 修改项目中的Tower，更名为Arrower，所有引用的位置都要同步更新
- 信息面板：增加建筑物的训练单位数量/上限属性、治疗量、治疗速度、攻击力显示，增加防御单位的攻击频率、移动速度属性显示；强化信息面板功能，在右侧增加单位的可操作按钮展示，暂定为九宫格样式显示九个按钮，按钮的贴图可以更新，升级和回收按钮放到此处展示，其余7个按钮暂时置空；

# 10
- 建造：点击build按钮之后，进入建造模式，在游戏界面下方出现一个选择建筑物的组件面板，占屏幕大概六分之一高度，可以在建筑物面板中选中战争古树或者其他建筑物，然后可以拖拽战争古树或其他建筑物到界面中，松开鼠标的同时开始建造建筑物，并且退出建造模式
- 战争古树：改为可以点击，点击后可以弹出弹框，弹窗方式参考Tower选中的弹窗，可以选择拆除，或者升级，升级消耗50%的建造成本，升级后生产Tower的上限可以增加两个
- 人口机制：增加人口机制，初始人口上限为10个，即最多产生10个Tower单位，在金币标签下增加人口标签，人口达到上限，战争古树即不能产生Tower
- 建筑物：增加建筑：月亮井，建造模式可选择的建筑物增加一个月亮井，成本10金币，月亮井不会攻击敌人，但是建造1个月亮井，会同时增加10个人口上限，月亮井也会被敌人攻击
- 月亮井：增加治愈功能，靠近月亮井方圆100像素点的友方单位比如Tower，每隔2秒恢复一点血量，并且Tower身上出现+号特效，后期支持替换为贴图特效；月亮井能被选中，能被拆除，也可以升级，升级后扩大治疗范围和治疗速度；


# 9
- 防御塔：增加一个建筑物机制，建筑物中有一种战争古树。build按钮改为放置战争古树，建造战争古树需要耗费10点金币，一颗战争古树会产生4个Tower单位，生产一个Tower需要耗费2秒，生产完成，Tower会出现在战争古树下方100像素点的位置，战争古树不可移动，但是可以攻击接近的敌人，也可以设置攻击动画
- 战争古树优化：战争古树生产出的Tower单位，出现在战争古树下方100像素点之后，需要往前方跑开一段距离，以给后面生成的Tower单位留出空间，防止单位重叠；而且战争古树生产出4个Tower单位，若其中有1个单位死亡了，则需要继续生产1个单位，补上4个单位的数量；战争古树生产Tower单位的时候，需要有一个进度条，每隔0.5秒前进一格，位于战争古树的血量条下方；

# 8 
- 敌人：刷新速度根据时间加快，每隔30秒，刷新速度提升一倍
- 敌人：刷新速度每次加快，屏幕中间都要出现提示信息，并且屏幕四周出现红边特效
- 游戏界面：游戏结束后，场上剩余敌人直接消失，防御单位也要停止移动


# 7
- 防御单位：被选中之后除了升级和回收，还能控制防御单位的移动，防御单位将朝下一次鼠标点击的位置移动，且以鼠标点击的位置为最优先目标，到达鼠标点击位置后，才会继续自动寻敌，若范围内无敌人则保持静止
- 防御单位：支持多选，鼠标可以拉取一个范围，在范围内的防御单位会高亮显示，并且都会朝向下一次鼠标点击的位置移动
- 防御单位：选中多个单位移动时，不能全部移动向点击的那一个点，因为单位之间存在碰撞体积，应该根据碰撞体积半径分散站好各自位置

# 6、第五轮优化
- 防御塔：改为可以自行移动，根据附近敌人的位置进行移动，当敌人进入2倍攻击范围内就朝敌人移动，敌人位于攻击范围内则停止移动开始攻击，移动动画也可以自行添加
- 防御塔：自行移动时候需要考虑碰撞体积，不可与水晶、敌人、或其他防御塔重叠，若路径上被其他单位挡住，则需要自动绕开


# 5、第四轮优化
- 防御塔：攻击时增加一个动画效果，现在已有一张包含了12张帧的图片，请告诉我怎么用cocos工具为防御塔增加攻击动画
-- 《防御塔攻击动画设置指南.md》
- 防御塔：可以播放12张动画了，但是有一点问题，射出arrow攻击应该是在播放完动画之后，现在是在开始播放动画的时候就射出arrow了
- 防御塔：现在组成攻击动画的12张图片是面朝右侧发起攻击，当敌人位于防御塔左侧的时候，需要翻转攻击图片朝左侧发起攻击
- 防御塔：现在防御塔头顶的血条也跟着一起翻转了，血条不要一起翻转


# 4、第三轮优化
- 伤害数值：不要固定-10，应该以对方的攻击力为显示数值
- 防御塔：血量降到0时没有产生爆炸特效
- 防御塔：攻击特效改为射出一支弓箭，弓箭贴图可以支持后期更新，射出轨迹需要有一点弧度，模拟真实箭矢效果
- 敌人：胜利之后不要再刷新敌人

# 3、第二轮优化
- 增加金币机制：在水晶血量下方增加金币显示，初始10金币，建造防御塔消耗5金币，消灭敌人获得2金币
- 优化敌人：增加血条显示，被攻击时，单位身上应该冒出受伤害的数值，并且血条会减少相应百分比
- 优化防御塔：增加血条显示，被攻击时，单位身上应该冒出受伤害的数值，并且血条会减少相应百分比
- 优化防御塔：支持回收和升级，点击防御塔所在位置，在单位上弹出一个半透明选择框，左侧是回收，按原价80%金币回收，右侧是升级
- 优化防御塔：升级机制，以双倍防御塔建造成本升级，升级后攻击力增加50%，攻击速度增加50%
- 现有的爆炸特效缺陷：一开始会出现在屏幕中央，0.5秒后消失，但预期是初始时不要出现在屏幕中
- 修改完成后，检查修改后的文件是否有报错，如有语法错误则修复
- 需要增加哪些标签，怎么操作cocos，详细介绍一下

# 2、第一轮缺陷
- 防御塔：建造位置不是鼠标第二次点击位置
- 防御塔：建造之后不会攻击敌人
- 敌人：不会优先攻击附近的防御塔
- 防御塔：攻击时需要产生类似激光特效
- 点击重新开始按钮，浏览器控制台报错：UIManager: GameManager is null!
- 游戏失败后，还在继续刷新敌人，需要停止刷新

# 1、创建一个简单塔防游戏的MVP
- 这是一个cocos空白2d工程，现在需要创建在这个空白工程上开发一个简单的塔防游戏，目的是发布到微信小程序
- 先完成塔防游戏第一关：
- 界面中央是一个水晶，100点血量，被敌人攻击就会减少血量
- 四周不断刷新敌人单位，往中央水晶移动，移动到水晶附近就开始攻击水晶
- 水晶周围可以建设防御塔，防御塔会攻击敌人单位
- 攻击机制：敌人接近防御塔之后会优先攻击防御塔，水晶周围没有防御塔了就会被敌人攻击
- 防御塔或者水晶血量到0了会炸开，敌人血量下降到0就会倒下，然后以逐渐透明效果从界面消失
- 水晶血量到0，游戏以失败结束
- 时间来到3分钟，游戏以成功结束


# 豆包生图提示词
- 背景图：生成一张竖版的背景图，俯视视角，暗夜精灵森林风格，四周是森林，中间有一块空地，放置一颗尚在幼年期的生命之树
- 防御塔：生成一张暗夜精灵弓箭手的Q版人物图，手持张开的弓箭
- 敌人：改为攻击动画播放了一半就调用攻击回调函数


- 豆包生成提示词工具：HPPTools-游戏图像描述生成助手
- HPPTools-Q版弓箭手，暗夜精灵风格，手持弓箭
- 豆包-图片风格为「Q 版」，构图为正面或 30 - 70 度微侧视角，主体为暗夜精灵风格的弓箭手全身完整呈现，手持弓箭，以标准的中性站立姿势，双手自然下垂握住弓箭，双脚与肩同宽、脚尖朝前，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- 豆包-帮我生成视频：人物向左转身后原地快速跑动
- 豆包-帮我生成视频：人物原地站立，拉开弓射出箭矢

- HPPTools-Q版战争古树：
- 混元：生命古树：图片风格Q版，构图为正面或 30 - 70 度微侧视角，幼年期生命古树这一暗夜精灵建筑物全身完整呈现，以自然中立形态，无多余装饰或杂物附着，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- 混元：战争古树：图片风格Q版，构图为正面或 30 - 70 度微侧视角，幼年期战争古树这一暗夜精灵建筑物全身完整呈现，以自然中立形态，无多余装饰或杂物附着，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- 混元：月亮井：图片风格为写实风格，构图为正面或 30 - 70 度微侧视角，暗夜精灵建筑物月亮井全身完整呈现，无任何遮挡，处于自然状态，位于画面正中央，边缘清晰锐利，背景为纯蓝色背景，平坦均匀光照，无阴影。
- 混元：图片风格为写实风格，构图为正面或 30 - 70 度微侧视角，主体为暗夜精灵风格的弓箭手全身完整呈现，左手持弓，以标准的中性站立姿势，双手自然下垂握住弓箭，双脚与肩同宽、脚尖朝前，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。

- 弓箭手：像素风格 2D 角色，图片风格Q版，暗夜精灵弓箭手，侧身站姿，全身图，深紫黑色潜行服配金色腰带，棕色弓箭握于右手，背后箭囊插满箭矢，黑色长发高束（金色发饰点缀），尖长精灵耳，白色纯色背景，角色比例协调，细节清晰

- banana-弓箭手：图片风格为「Q 版」，构图为正面或 30 - 70 度微侧视角，主体为暗夜精灵风格的弓箭手全身完整呈现，手持弓箭，以标准的中性站立姿势，双手自然下垂握住弓箭，双脚与肩同宽、脚尖朝前，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- banana-女猎手：参考弓箭手的画风，生成一个骑着黑豹的女猎手。
- banana-猎手大厅：按照这种画风，生成一个适宜此角色居住的猎手大厅，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- banana-熊：参考弓箭手的画风，生成一只可爱熊。
- banana-弓箭手小屋：按照这种画风，生成一个适宜此角色居住的林中小屋，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- 小精灵：「Q 版」可爱像素风格，主体为小精灵全身完整呈现，银白色精灵仙子，侧身悬浮姿态，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- 生命之树：按照这种画风，生成一个适宜此角色居住的生命之树，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- banana-石墙：按照这种画风，生成一个和谐自然的石墙，墙上布满青苔，位于画面中央，边缘清晰锐利，背景为纯白色背景，平坦均匀光照、无阴影。
- banana-女剑士：（先生成一个经典saber形象）参考1图弓箭手的画风，生成一个女剑士，女剑士的装备和形象参考2图的saber，是精灵版本的saber。














