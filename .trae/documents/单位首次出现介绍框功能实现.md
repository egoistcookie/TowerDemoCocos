# 单位首次出现介绍框功能实现

## 1. 功能需求
- 当场上首次出现某一种建筑物或单位时，游戏暂停
- 出现一个占据屏幕下方三分之一大小的介绍框
- 介绍框左侧为单位的图片展示，右侧为单位的信息介绍
- 为每种单位的脚本增加信息介绍属性，可在Cocos编辑器中添加
- 提示框被点击后消失，游戏继续

## 2. 实现方案

### 2.1 创建单位介绍弹窗组件
- 创建 `UnitIntroPopup.ts` 脚本，用于显示单位介绍
- 包含以下功能：
  - 显示单位图片
  - 显示单位名称、描述、属性等信息
  - 点击关闭功能
  - 暂停/继续游戏控制

### 2.2 扩展单位脚本
- 为所有单位脚本（Enemy, OrcWarrior, OrcWarlord, Arrower, Hunter, 建筑物等）添加信息属性
- 添加以下属性：
  - `unitName`: 单位名称
  - `unitDescription`: 单位描述
  - `unitType`: 单位类型
  - `unitIcon`: 单位图标
  - `unitStats`: 单位属性（可选）

### 2.3 实现单位首次出现检测
- 在 `GameManager.ts` 中添加：
  - 已出现单位类型集合
  - 单位首次出现检查方法
  - 暂停/继续游戏方法
  - 显示单位介绍弹窗方法

### 2.4 集成到单位生成流程
- 修改 `EnemySpawner.ts` 和建筑物生成逻辑
- 在单位生成时调用 `GameManager` 的检查方法
- 首次出现时显示介绍弹窗

## 3. 详细实施步骤

### 步骤1：创建 UnitIntroPopup 组件
1. 创建 `UnitIntroPopup.ts` 脚本
2. 添加必要的属性：
   - `@property(Node)` `container: Node` - 弹窗容器
   - `@property(Sprite)` `unitIcon: Sprite` - 单位图标
   - `@property(Label)` `unitName: Label` - 单位名称
   - `@property(Label)` `unitDescription: Label` - 单位描述
   - `@property(Button)` `closeButton: Button` - 关闭按钮
3. 实现 `show(unitInfo)` 方法
4. 实现 `hide()` 方法
5. 实现点击关闭事件

### 步骤2：扩展 GameManager
1. 在 `GameManager.ts` 中添加：
   - `private appearedUnitTypes: Set<string> = new Set();` - 已出现单位类型集合
   - `private unitIntroPopup: any = null;` - 单位介绍弹窗引用
   - `public checkUnitFirstAppearance(unitType: string, unitScript: any): boolean` - 检查单位是否首次出现
   - `public showUnitIntro(unitScript: any): void` - 显示单位介绍
   - `public pauseGame(): void` - 暂停游戏
   - `public resumeGame(): void` - 继续游戏
2. 实现单位首次出现检查逻辑
3. 实现游戏暂停/继续逻辑

### 步骤3：扩展单位脚本
为以下单位脚本添加信息属性：
- `Enemy.ts`
- `OrcWarrior.ts`
- `OrcWarlord.ts`
- `Arrower.ts`
- `Hunter.ts`
- `WarAncientTree.ts`
- `MoonWell.ts`
- `HunterHall.ts`
- `Tree.ts`

添加的属性：
```typescript
@property
unitName: string = "单位名称";

@property
unitDescription: string = "单位描述";

@property(SpriteFrame)
unitIcon: SpriteFrame = null!;

@property
unitType: string = "enemy";
```

### 步骤4：集成到单位生成流程
1. 在 `EnemySpawner.ts` 的 `spawnEnemy` 方法中添加：
   ```typescript
   // 检查单位是否首次出现
   if (this.gameManager && enemyScript) {
       const isFirstAppearance = this.gameManager.checkUnitFirstAppearance(enemyScript.unitType, enemyScript);
       if (isFirstAppearance) {
           // 延迟一下显示，确保单位已经创建完成
           this.scheduleOnce(() => {
               this.gameManager.showUnitIntro(enemyScript);
           }, 0.1);
       }
   }
   ```

2. 在建筑物生成逻辑中添加类似的检查

### 步骤5：创建弹窗UI
1. 在 Cocos 编辑器中创建弹窗UI：
   - 容器节点，占据屏幕下方三分之一
   - 左侧单位图片展示区
   - 右侧单位信息介绍区
   - 关闭按钮
2. 绑定 `UnitIntroPopup` 组件
3. 配置样式和动画

## 4. 技术要点
- 使用 `Set` 数据结构跟踪已出现的单位类型
- 利用 `@property` 装饰器让属性可在编辑器中配置
- 实现游戏暂停/继续机制，可能需要修改 `GameManager` 的 `update` 方法
- 弹窗的层级管理，确保在最上层显示
- 单位图标和描述的动态加载

## 5. 预期效果
- 当首次出现新单位时，游戏暂停
- 屏幕下方出现介绍框，显示单位图片和信息
- 点击介绍框后，游戏继续
- 同种单位再次出现时，不再显示介绍框

## 6. 代码结构
```
├── assets/
│   └── scripts/
│       ├── GameManager.ts          # 扩展，添加单位首次出现检测
│       ├── UIManager.ts            # 扩展，添加单位介绍弹窗管理
│       ├── UnitIntroPopup.ts       # 新增，单位介绍弹窗组件
│       ├── Enemy.ts                # 扩展，添加单位信息属性
│       ├── OrcWarrior.ts           # 扩展，添加单位信息属性
│       ├── OrcWarlord.ts           # 扩展，添加单位信息属性
│       ├── Arrower.ts              # 扩展，添加单位信息属性
│       ├── Hunter.ts               # 扩展，添加单位信息属性
│       ├── WarAncientTree.ts       # 扩展，添加单位信息属性
│       ├── MoonWell.ts             # 扩展，添加单位信息属性
│       ├── HunterHall.ts           # 扩展，添加单位信息属性
│       ├── Tree.ts                 # 扩展，添加单位信息属性
│       └── EnemySpawner.ts         # 扩展，添加单位首次出现检查
```

## 7. 测试计划
1. 运行游戏，检查首次出现的敌人是否显示介绍框
2. 检查介绍框的内容和样式
3. 点击介绍框，检查游戏是否继续
4. 检查同种敌人再次出现时是否不再显示介绍框
5. 检查不同类型的单位是否都能正确显示介绍框
6. 检查建筑物首次出现时是否显示介绍框

通过以上步骤，我们可以实现单位首次出现时的介绍框功能，提升游戏的教学性和用户体验。